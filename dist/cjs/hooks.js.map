{"version":3,"file":"hooks.js","names":["HOOKS","exports","preAddRxPlugin","preCreateRxDatabase","createRxDatabase","preCreateRxCollection","createRxCollection","createRxState","postCloseRxCollection","postRemoveRxCollection","preCreateRxSchema","createRxSchema","prePrepareRxQuery","preCreateRxQuery","prePrepareQuery","createRxDocument","postCreateRxDocument","preCreateRxStorageInstance","preStorageWrite","preMigrateDocument","postMigrateDocument","preCloseRxDatabase","postRemoveRxDatabase","postCleanup","preReplicationMasterWrite","preReplicationMasterWriteDocumentsHandle","runPluginHooks","hookKey","obj","length","forEach","fun","runAsyncPluginHooks","fn","_clearHook","type","filter","h"],"sources":["../../src/hooks.ts"],"sourcesContent":["\r\n/**\r\n * hook-functions that can be extended by the plugin\r\n */\r\nexport const HOOKS = {\r\n    /**\r\n     * Runs before a plugin is added.\r\n     * Use this to block the usage of non-compatible plugins.\r\n     */\r\n    preAddRxPlugin: [],\r\n    /**\r\n     * functions that run before the database is created\r\n     */\r\n    preCreateRxDatabase: [],\r\n    /**\r\n     * runs after the database is created and prepared\r\n     * but before the instance is returned to the user\r\n     * @async\r\n     */\r\n    createRxDatabase: [],\r\n    preCreateRxCollection: [],\r\n    createRxCollection: [],\r\n    createRxState: [],\r\n    /**\r\n    * runs at the end of the close-process of a collection\r\n    * @async\r\n    */\r\n    postCloseRxCollection: [],\r\n    /**\r\n     * Runs after a collection is removed.\r\n     * @async\r\n     */\r\n    postRemoveRxCollection: [],\r\n    /**\r\n      * functions that get the json-schema as input\r\n      * to do additionally checks/manipulation\r\n      */\r\n    preCreateRxSchema: [],\r\n    /**\r\n     * functions that run after the RxSchema is created\r\n     * gets RxSchema as attribute\r\n     */\r\n    createRxSchema: [],\r\n    prePrepareRxQuery: [],\r\n    preCreateRxQuery: [],\r\n    /**\r\n     * Runs before a query is send to the\r\n     * prepareQuery function of the storage engine.\r\n     */\r\n    prePrepareQuery: [],\r\n    createRxDocument: [],\r\n    /**\r\n     * runs after a RxDocument is created,\r\n     * cannot be async\r\n     */\r\n    postCreateRxDocument: [],\r\n    /**\r\n     * Runs before a RxStorageInstance is created\r\n     * gets the params of createStorageInstance()\r\n     * as attribute so you can manipulate them.\r\n     * Notice that you have to clone stuff before mutating the inputs.\r\n     */\r\n    preCreateRxStorageInstance: [],\r\n    preStorageWrite: [],\r\n    /**\r\n     * runs on the document-data before the document is migrated\r\n     * {\r\n     *   doc: Object, // original doc-data\r\n     *   migrated: // migrated doc-data after run through migration-strategies\r\n     * }\r\n     */\r\n    preMigrateDocument: [],\r\n    /**\r\n     * runs after the migration of a document has been done\r\n     */\r\n    postMigrateDocument: [],\r\n    /**\r\n     * runs at the beginning of the close-process of a database\r\n     */\r\n    preCloseRxDatabase: [],\r\n    /**\r\n     * runs after a database has been removed\r\n     * @async\r\n     */\r\n    postRemoveRxDatabase: [],\r\n\r\n\r\n    postCleanup: [],\r\n\r\n    /**\r\n     * runs before the replication writes the rows to master\r\n     * but before the rows have been modified\r\n     * @async\r\n     */\r\n    preReplicationMasterWrite: [],\r\n\r\n    /**\r\n     * runs after the replication has been sent to the server\r\n     * but before the new documents have been handled\r\n     * @async\r\n     */\r\n    preReplicationMasterWriteDocumentsHandle: [],\r\n};\r\n\r\nexport function runPluginHooks(hookKey: keyof typeof HOOKS, obj: any) {\r\n    if (HOOKS[hookKey].length > 0) {\r\n        HOOKS[hookKey].forEach(fun => (fun as any)(obj));\r\n    }\r\n}\r\n\r\n\r\n/**\r\n * We do intentionally not run the hooks in parallel\r\n * because that makes stuff unpredictable and we use runAsyncPluginHooks()\r\n * only in places that are not that relevant for performance.\r\n */\r\nexport async function runAsyncPluginHooks(hookKey: keyof typeof HOOKS, obj: any): Promise<any> {\r\n    for (const fn of HOOKS[hookKey]) {\r\n        await (fn as any)(obj);\r\n    }\r\n}\r\n\r\n/**\r\n * used in tests to remove hooks\r\n */\r\nexport function _clearHook(type: keyof typeof HOOKS, fun: Function) {\r\n    HOOKS[type] = HOOKS[type].filter(h => h !== fun);\r\n}\r\n"],"mappings":";;;;;;;;;AACA;AACA;AACA;AACO,IAAMA,KAAK,GAAAC,OAAA,CAAAD,KAAA,GAAG;EACjB;AACJ;AACA;AACA;EACIE,cAAc,EAAE,EAAE;EAClB;AACJ;AACA;EACIC,mBAAmB,EAAE,EAAE;EACvB;AACJ;AACA;AACA;AACA;EACIC,gBAAgB,EAAE,EAAE;EACpBC,qBAAqB,EAAE,EAAE;EACzBC,kBAAkB,EAAE,EAAE;EACtBC,aAAa,EAAE,EAAE;EACjB;AACJ;AACA;AACA;EACIC,qBAAqB,EAAE,EAAE;EACzB;AACJ;AACA;AACA;EACIC,sBAAsB,EAAE,EAAE;EAC1B;AACJ;AACA;AACA;EACIC,iBAAiB,EAAE,EAAE;EACrB;AACJ;AACA;AACA;EACIC,cAAc,EAAE,EAAE;EAClBC,iBAAiB,EAAE,EAAE;EACrBC,gBAAgB,EAAE,EAAE;EACpB;AACJ;AACA;AACA;EACIC,eAAe,EAAE,EAAE;EACnBC,gBAAgB,EAAE,EAAE;EACpB;AACJ;AACA;AACA;EACIC,oBAAoB,EAAE,EAAE;EACxB;AACJ;AACA;AACA;AACA;AACA;EACIC,0BAA0B,EAAE,EAAE;EAC9BC,eAAe,EAAE,EAAE;EACnB;AACJ;AACA;AACA;AACA;AACA;AACA;EACIC,kBAAkB,EAAE,EAAE;EACtB;AACJ;AACA;EACIC,mBAAmB,EAAE,EAAE;EACvB;AACJ;AACA;EACIC,kBAAkB,EAAE,EAAE;EACtB;AACJ;AACA;AACA;EACIC,oBAAoB,EAAE,EAAE;EAGxBC,WAAW,EAAE,EAAE;EAEf;AACJ;AACA;AACA;AACA;EACIC,yBAAyB,EAAE,EAAE;EAE7B;AACJ;AACA;AACA;AACA;EACIC,wCAAwC,EAAE;AAC9C,CAAC;AAEM,SAASC,cAAcA,CAACC,OAA2B,EAAEC,GAAQ,EAAE;EAClE,IAAI5B,KAAK,CAAC2B,OAAO,CAAC,CAACE,MAAM,GAAG,CAAC,EAAE;IAC3B7B,KAAK,CAAC2B,OAAO,CAAC,CAACG,OAAO,CAACC,GAAG,IAAKA,GAAG,CAASH,GAAG,CAAC,CAAC;EACpD;AACJ;;AAGA;AACA;AACA;AACA;AACA;AACO,eAAeI,mBAAmBA,CAACL,OAA2B,EAAEC,GAAQ,EAAgB;EAC3F,KAAK,IAAMK,EAAE,IAAIjC,KAAK,CAAC2B,OAAO,CAAC,EAAE;IAC7B,MAAOM,EAAE,CAASL,GAAG,CAAC;EAC1B;AACJ;;AAEA;AACA;AACA;AACO,SAASM,UAAUA,CAACC,IAAwB,EAAEJ,GAAa,EAAE;EAChE/B,KAAK,CAACmC,IAAI,CAAC,GAAGnC,KAAK,CAACmC,IAAI,CAAC,CAACC,MAAM,CAACC,CAAC,IAAIA,CAAC,KAAKN,GAAG,CAAC;AACpD","ignoreList":[]}