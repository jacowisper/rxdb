{"version":3,"file":"index.js","names":["_utilsMap","require","_rxState","_helpers","Object","keys","forEach","key","prototype","hasOwnProperty","call","_exportNames","exports","defineProperty","enumerable","get","STATE_BY_DATABASE","WeakMap","addState","namespace","stateCache","getFromMapOrCreate","Map","state","createRxState","states","RxDBStatePlugin","name","rxdb","prototypes","RxDatabase","proto"],"sources":["../../../../src/plugins/state/index.ts"],"sourcesContent":["import type {\r\n    RxDatabase,\r\n    RxPlugin,\r\n    RxState\r\n} from '../../types/index.d.ts';\r\nimport { getFromMapOrCreate } from '../utils/utils-map.ts';\r\nimport { RxStateBase, createRxState } from './rx-state.ts';\r\n\r\nexport * from './helpers.ts';\r\n\r\ntype StateByPrefix = Map<string, Promise<RxStateBase<any>>>;\r\nconst STATE_BY_DATABASE = new WeakMap<RxDatabase, StateByPrefix>();\r\n\r\nexport async function addState<T>(\r\n    this: RxDatabase,\r\n    namespace: string = ''\r\n): Promise<RxState<T>> {\r\n    const stateCache = getFromMapOrCreate<RxDatabase, StateByPrefix>(\r\n        STATE_BY_DATABASE,\r\n        this,\r\n        () => new Map()\r\n    );\r\n    const state = await getFromMapOrCreate(\r\n        stateCache,\r\n        namespace,\r\n        () => createRxState<T>(this, namespace)\r\n    );\r\n    this.states[namespace] = state;\r\n    return state as any;\r\n}\r\n\r\nexport const RxDBStatePlugin: RxPlugin = {\r\n    name: 'state',\r\n    rxdb: true,\r\n    prototypes: {\r\n        RxDatabase(proto: any) {\r\n            proto.addState = addState;\r\n        }\r\n    }\r\n};\r\n"],"mappings":";;;;;;;;;;;AAKA,IAAAA,SAAA,GAAAC,OAAA;AACA,IAAAC,QAAA,GAAAD,OAAA;AAEA,IAAAE,QAAA,GAAAF,OAAA;AAAAG,MAAA,CAAAC,IAAA,CAAAF,QAAA,EAAAG,OAAA,WAAAC,GAAA;EAAA,IAAAA,GAAA,kBAAAA,GAAA;EAAA,IAAAH,MAAA,CAAAI,SAAA,CAAAC,cAAA,CAAAC,IAAA,CAAAC,YAAA,EAAAJ,GAAA;EAAA,IAAAA,GAAA,IAAAK,OAAA,IAAAA,OAAA,CAAAL,GAAA,MAAAJ,QAAA,CAAAI,GAAA;EAAAH,MAAA,CAAAS,cAAA,CAAAD,OAAA,EAAAL,GAAA;IAAAO,UAAA;IAAAC,GAAA,WAAAA,CAAA;MAAA,OAAAZ,QAAA,CAAAI,GAAA;IAAA;EAAA;AAAA;AAGA,IAAMS,iBAAiB,GAAG,IAAIC,OAAO,CAA4B,CAAC;AAE3D,eAAeC,QAAQA,CAE1BC,SAAiB,GAAG,EAAE,EACH;EACnB,IAAMC,UAAU,GAAG,IAAAC,4BAAkB,EACjCL,iBAAiB,EACjB,IAAI,EACJ,MAAM,IAAIM,GAAG,CAAC,CAClB,CAAC;EACD,IAAMC,KAAK,GAAG,MAAM,IAAAF,4BAAkB,EAClCD,UAAU,EACVD,SAAS,EACT,MAAM,IAAAK,sBAAa,EAAI,IAAI,EAAEL,SAAS,CAC1C,CAAC;EACD,IAAI,CAACM,MAAM,CAACN,SAAS,CAAC,GAAGI,KAAK;EAC9B,OAAOA,KAAK;AAChB;AAEO,IAAMG,eAAyB,GAAAd,OAAA,CAAAc,eAAA,GAAG;EACrCC,IAAI,EAAE,OAAO;EACbC,IAAI,EAAE,IAAI;EACVC,UAAU,EAAE;IACRC,UAAUA,CAACC,KAAU,EAAE;MACnBA,KAAK,CAACb,QAAQ,GAAGA,QAAQ;IAC7B;EACJ;AACJ,CAAC","ignoreList":[]}