{"version":3,"file":"graphql-schema-from-rx-schema.js","names":["_getGraphqlFromJsonschema","require","_rxSchemaHelper","_index","SPACING","exports","graphQLSchemaFromRxSchema","input","ret","asString","queries","mutations","subscriptions","inputs","types","Object","entries","forEach","collectionName","collectionSettings","fillUpOptionals","schema","prefixes","ensureNotFalsy","ucCollectionName","ucfirst","collectionNameInput","inputSchema","stripKeysFromSchema","ignoreInputKeys","inputGraphQL","getGraphqlSchemaFromJsonSchema","rootName","direction","pushRowGraphQL","pushRow","type","properties","assumedMasterState","newDocumentState","required","additionalProperties","checkpointSchema","checkpointFields","key","subSchema","push","checkpointInputGraphQL","checkpoint","concat","typeDefinitions","map","str","replaceTopLevelTypeName","headersSchema","headerFields","headerField","headersInputName","headers","headersInputGraphQL","length","outputSchema","ignoreOutputKeys","outputGraphQL","checkpointOutputGraphQL","pullBulkOutputGraphQL","pullBulk","documents","items","queryName","pull","queryKeys","queryString","join","mutationName","mutationString","subscriptionHeaderInputString","subscriptionName","stream","subscriptionString","fullQueryString","fullMutationString","fullSubscriptionString","fullTypeString","fullInputString","fullSchemaString","flatClone","fillWithDefaultSettings","keys","startsWith","deletedField","withRevisions","strip","cloned","clone","replace"],"sources":["../../../../src/plugins/replication-graphql/graphql-schema-from-rx-schema.ts"],"sourcesContent":["import { getGraphqlSchemaFromJsonSchema } from 'get-graphql-from-jsonschema';\r\n\r\nimport { fillWithDefaultSettings } from '../../rx-schema-helper.ts';\r\n\r\nimport type { RxJsonSchema } from '../../types/index.d.ts';\r\nimport { clone, ensureNotFalsy, flatClone, ucfirst } from '../../plugins/utils/index.ts';\r\n\r\nexport type Prefixes = {\r\n    push?: string;\r\n    pushRow?: string;\r\n    checkpoint?: string;\r\n    pull?: string;\r\n    pullBulk?: string;\r\n    stream?: string;\r\n    headers?: string;\r\n};\r\n\r\n/**\r\n * just type some common types\r\n * to have better IDE autocomplete,\r\n * all strings are allowed\r\n */\r\nexport type GraphQLParamType = 'ID' | 'ID!' |\r\n    'String' | 'String!' |\r\n    'Int' | 'Int!' |\r\n    'Float' | 'Float!' |\r\n    string;\r\n\r\nexport type GraphQLSchemaFromRxSchemaInputSingleCollection = {\r\n    schema: RxJsonSchema<any>;\r\n    /**\r\n     * These fields of the document data\r\n     * will be used for the checkpoint.\r\n     */\r\n    checkpointFields: string[];\r\n    ignoreInputKeys?: string[];\r\n    ignoreOutputKeys?: string[];\r\n    withRevisions?: boolean;\r\n    prefixes?: Prefixes;\r\n    headerFields?: string[];\r\n    /**\r\n     * Name of the boolean field that marks deleted documents.\r\n     * [default='_deleted']\r\n     */\r\n    deletedField?: string;\r\n};\r\n\r\nexport type GraphQLSchemaFromRxSchemaInput = {\r\n    [collectionName: string]: GraphQLSchemaFromRxSchemaInputSingleCollection;\r\n};\r\nexport type GraphQLSchemaFromRxSchemaOutput = {\r\n    asString: string;\r\n    queries: string[];\r\n    mutations: string[];\r\n    subscriptions: string[];\r\n    inputs: string[];\r\n    types: string[];\r\n};\r\n\r\n// we use two spaces because get-graphql-from-jsonschema does also\r\nexport const SPACING = '  ';\r\n\r\n/**\r\n * Create a GraphQL schema from a given RxJsonSchema\r\n */\r\nexport function graphQLSchemaFromRxSchema(\r\n    input: GraphQLSchemaFromRxSchemaInput\r\n): GraphQLSchemaFromRxSchemaOutput {\r\n    const ret: GraphQLSchemaFromRxSchemaOutput = {\r\n        asString: '',\r\n        queries: [],\r\n        mutations: [],\r\n        subscriptions: [],\r\n        inputs: [],\r\n        types: []\r\n    };\r\n\r\n    Object.entries(input).forEach(([collectionName, collectionSettings]) => {\r\n        collectionSettings = fillUpOptionals(collectionSettings);\r\n\r\n        const schema = collectionSettings.schema;\r\n        const prefixes: Prefixes = ensureNotFalsy(collectionSettings.prefixes);\r\n        const ucCollectionName = ucfirst(collectionName);\r\n        const collectionNameInput = ucfirst(collectionName) + 'Input';\r\n\r\n        // input\r\n        const inputSchema = stripKeysFromSchema(schema, ensureNotFalsy(collectionSettings.ignoreInputKeys));\r\n\r\n        const inputGraphQL = getGraphqlSchemaFromJsonSchema({\r\n            rootName: collectionNameInput,\r\n            schema: inputSchema as any,\r\n            direction: 'input'\r\n        });\r\n        const pushRowGraphQL = getGraphqlSchemaFromJsonSchema({\r\n            rootName: collectionNameInput + prefixes.pushRow,\r\n            schema: {\r\n                type: 'object',\r\n                properties: {\r\n                    assumedMasterState: inputSchema as any,\r\n                    newDocumentState: inputSchema as any\r\n                },\r\n                required: ['newDocumentState'],\r\n                additionalProperties: false\r\n            },\r\n            direction: 'input'\r\n        });\r\n\r\n        const checkpointSchema = {\r\n            type: 'object',\r\n            properties: {},\r\n            required: [],\r\n            additionalProperties: false\r\n        } as any;\r\n        collectionSettings.checkpointFields.forEach(key => {\r\n            const subSchema: any = schema.properties[key];\r\n            checkpointSchema.properties[key] = subSchema;\r\n            checkpointSchema.required.push(key);\r\n        });\r\n        const checkpointInputGraphQL = getGraphqlSchemaFromJsonSchema({\r\n            rootName: collectionNameInput + prefixes.checkpoint,\r\n            schema: checkpointSchema as any,\r\n            direction: 'input'\r\n        });\r\n\r\n        ret.inputs = ret.inputs.concat(\r\n            inputGraphQL\r\n                .typeDefinitions\r\n                .map(str => replaceTopLevelTypeName(str, collectionNameInput))\r\n        ).concat(\r\n            pushRowGraphQL\r\n                .typeDefinitions\r\n                .map(str => replaceTopLevelTypeName(str, collectionNameInput + prefixes.pushRow))\r\n        ).concat(\r\n            checkpointInputGraphQL\r\n                .typeDefinitions\r\n                .map(str => replaceTopLevelTypeName(str, collectionNameInput + prefixes.checkpoint))\r\n        );\r\n\r\n        const headersSchema: any = {\r\n            type: 'object',\r\n            additionalProperties: false,\r\n            properties: {},\r\n            required: []\r\n        };\r\n        ensureNotFalsy(collectionSettings.headerFields).forEach(headerField => {\r\n            headersSchema.properties[headerField] = {\r\n                type: 'string'\r\n            };\r\n            headersSchema.required.push(headerField);\r\n        });\r\n        const headersInputName = collectionNameInput + prefixes.headers;\r\n        const headersInputGraphQL = getGraphqlSchemaFromJsonSchema({\r\n            rootName: headersInputName,\r\n            schema: headersSchema,\r\n            direction: 'input'\r\n        });\r\n        if (ensureNotFalsy(collectionSettings.headerFields).length > 0) {\r\n            ret.inputs = ret.inputs.concat(\r\n                headersInputGraphQL\r\n                    .typeDefinitions\r\n                    .map(str => replaceTopLevelTypeName(str, headersInputName))\r\n            );\r\n        }\r\n\r\n        // output\r\n        const outputSchema = stripKeysFromSchema(schema, ensureNotFalsy(collectionSettings.ignoreOutputKeys));\r\n        const outputGraphQL = getGraphqlSchemaFromJsonSchema({\r\n            rootName: collectionName,\r\n            schema: outputSchema as any,\r\n            direction: 'output'\r\n        });\r\n        const checkpointOutputGraphQL = getGraphqlSchemaFromJsonSchema({\r\n            rootName: ucCollectionName + prefixes.checkpoint,\r\n            schema: checkpointSchema as any,\r\n            direction: 'output'\r\n        });\r\n        const pullBulkOutputGraphQL = getGraphqlSchemaFromJsonSchema({\r\n            rootName: ucCollectionName + prefixes.pullBulk,\r\n            schema: {\r\n                type: 'object',\r\n                properties: {\r\n                    documents: {\r\n                        type: 'array',\r\n                        items: inputSchema as any\r\n                    },\r\n                    checkpoint: checkpointSchema as any\r\n                },\r\n                required: ['documents', 'checkpoint'],\r\n                additionalProperties: false\r\n            },\r\n            direction: 'output'\r\n        });\r\n        ret.types = ret.types.concat(\r\n            outputGraphQL.typeDefinitions\r\n                .map(str => replaceTopLevelTypeName(str, ucCollectionName))\r\n        ).concat(\r\n            checkpointOutputGraphQL.typeDefinitions\r\n                .map(str => replaceTopLevelTypeName(str, ucCollectionName + prefixes.checkpoint))\r\n        ).concat(\r\n            pullBulkOutputGraphQL.typeDefinitions\r\n                .map(str => replaceTopLevelTypeName(str, ucCollectionName + prefixes.pullBulk))\r\n        );\r\n\r\n        // query\r\n        const queryName = prefixes.pull + ucCollectionName;\r\n        const queryKeys = [\r\n            'checkpoint: ' + collectionNameInput + prefixes.checkpoint,\r\n            'limit: Int!'\r\n        ];\r\n        const queryString = queryName + '(' + queryKeys.join(', ') + '): ' + ucCollectionName + prefixes.pullBulk + '!';\r\n        ret.queries.push(SPACING + queryString);\r\n\r\n        // mutation\r\n        const mutationName = prefixes.push + ucCollectionName;\r\n        const mutationString = mutationName + '(' + collectionName + prefixes.pushRow + ': [' + collectionNameInput + prefixes.pushRow + ']): [' + ucCollectionName + '!]!';\r\n        ret.mutations.push(SPACING + mutationString);\r\n\r\n        // subscription\r\n        let subscriptionHeaderInputString = '';\r\n        if (collectionSettings.headerFields && collectionSettings.headerFields.length > 0) {\r\n            subscriptionHeaderInputString = '(headers: ' + headersInputName + ')';\r\n        }\r\n        const subscriptionName = prefixes.stream + ucCollectionName;\r\n        const subscriptionString = subscriptionName + subscriptionHeaderInputString + ': ' + ucCollectionName + prefixes.pullBulk + '!';\r\n        ret.subscriptions.push(SPACING + subscriptionString);\r\n    });\r\n\r\n    // build full string\r\n    const fullQueryString = 'type Query {\\n' + ret.queries.join('\\n') + '\\n}\\n';\r\n    const fullMutationString = 'type Mutation {\\n' + ret.mutations.join('\\n') + '\\n}\\n';\r\n    const fullSubscriptionString = 'type Subscription {\\n' + ret.subscriptions.join('\\n') + '\\n}\\n';\r\n\r\n    const fullTypeString = ret.types.join('\\n');\r\n    const fullInputString = ret.inputs.join('\\n');\r\n\r\n    const fullSchemaString = '' +\r\n        'schema {\\n' +\r\n        SPACING + 'query: Query\\n' +\r\n        SPACING + 'mutation: Mutation\\n' +\r\n        SPACING + 'subscription: Subscription\\n' +\r\n        '}\\n';\r\n\r\n    ret.asString = '' +\r\n        fullQueryString + '\\n' +\r\n        fullMutationString + '\\n' +\r\n        fullSubscriptionString + '\\n' +\r\n        fullTypeString + '\\n' +\r\n        fullInputString + '\\n' +\r\n        fullSchemaString;\r\n\r\n    return ret;\r\n}\r\n\r\n\r\nexport function fillUpOptionals(\r\n    input: GraphQLSchemaFromRxSchemaInputSingleCollection\r\n): GraphQLSchemaFromRxSchemaInputSingleCollection {\r\n    input = flatClone(input);\r\n\r\n    const schema = fillWithDefaultSettings(input.schema);\r\n    // strip internal attributes\r\n    Object.keys(schema.properties).forEach(key => {\r\n        if (key.startsWith('_')) {\r\n            delete schema.properties[key];\r\n        }\r\n    });\r\n    input.schema = schema;\r\n\r\n    // add deleted field to schema\r\n    if (!input.deletedField) {\r\n        input.deletedField = '_deleted';\r\n    }\r\n    schema.properties[input.deletedField] = {\r\n        type: 'boolean'\r\n    };\r\n    (schema.required as string[]).push(input.deletedField);\r\n\r\n    // fill up prefixes\r\n    if (!input.prefixes) {\r\n        input.prefixes = {} as any;\r\n    }\r\n    const prefixes: Prefixes = input.prefixes as any;\r\n    if (!prefixes.push) {\r\n        prefixes.push = 'push';\r\n    }\r\n    if (!prefixes.pushRow) {\r\n        prefixes.pushRow = 'PushRow';\r\n    }\r\n    if (!prefixes.checkpoint) {\r\n        prefixes.checkpoint = 'Checkpoint';\r\n    }\r\n    if (!prefixes.pull) {\r\n        prefixes.pull = 'pull';\r\n    }\r\n    if (!prefixes.pullBulk) {\r\n        prefixes.pullBulk = 'PullBulk';\r\n    }\r\n    if (!prefixes.stream) {\r\n        prefixes.stream = 'stream';\r\n    }\r\n    if (!prefixes.headers) {\r\n        prefixes.headers = 'Headers';\r\n    }\r\n    if (!input.headerFields) {\r\n        input.headerFields = [];\r\n    }\r\n\r\n\r\n    if (!input.withRevisions) {\r\n        input.withRevisions = false;\r\n    }\r\n\r\n    if (!input.ignoreInputKeys) {\r\n        input.ignoreInputKeys = [];\r\n    }\r\n    if (!input.ignoreOutputKeys) {\r\n        input.ignoreOutputKeys = [];\r\n    }\r\n\r\n    return input;\r\n}\r\n\r\nfunction stripKeysFromSchema<T>(schema: RxJsonSchema<T>, strip: string[]): RxJsonSchema<Partial<T>> {\r\n    const cloned: any = clone(schema);\r\n    strip.forEach(key => {\r\n        delete cloned.properties[key];\r\n    });\r\n    return cloned;\r\n}\r\n\r\n/**\r\n * get-graphql-from-jsonschema add a T0-suffix\r\n * that we do not want for the top level type\r\n */\r\nfunction replaceTopLevelTypeName(str: string, ucCollectionName: string): string {\r\n    return str.replace(' ' + ucCollectionName + 'T0 ', ' ' + ucCollectionName + ' ');\r\n}\r\n"],"mappings":"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","ignoreList":[]}