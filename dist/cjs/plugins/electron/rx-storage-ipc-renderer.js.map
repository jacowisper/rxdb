{"version":3,"file":"rx-storage-ipc-renderer.js","names":["_rxjs","require","_index","_electronHelper","_index2","getRxStorageIpcRenderer","settings","channelId","IPC_RENDERER_KEY_PREFIX","key","join","storage","getRxStorageRemote","identifier","mode","messageChannelCreator","messages$","Subject","listener","_event","message","next","ipcRenderer","on","postMessage","Promise","resolve","send","msg","close","removeListener","PROMISE_RESOLVE_VOID"],"sources":["../../../../src/plugins/electron/rx-storage-ipc-renderer.ts"],"sourcesContent":["import { Subject } from 'rxjs';\r\nimport {\r\n    getRxStorageRemote,\r\n    RxStorageRemote,\r\n    RxStorageRemoteSettings,\r\n    MessageFromRemote\r\n} from '../storage-remote/index.ts';\r\nimport {\r\n    IPC_RENDERER_KEY_PREFIX\r\n} from './electron-helper.ts';\r\nimport { PROMISE_RESOLVE_VOID } from '../utils/index.ts';\r\n\r\nexport type RxStorageIpcRendererSettings = {\r\n    /**\r\n     * Set the same key on both sides\r\n     * to ensure that messages do not get mixed\r\n     * up when you use more then one storage.\r\n     */\r\n    key: string;\r\n    ipcRenderer: any;\r\n    mode: RxStorageRemoteSettings['mode'];\r\n};\r\n\r\nexport type RxStorageIpcRenderer = RxStorageRemote;\r\nexport function getRxStorageIpcRenderer(\r\n    settings: RxStorageIpcRendererSettings\r\n): RxStorageIpcRenderer {\r\n    const channelId = [\r\n        IPC_RENDERER_KEY_PREFIX,\r\n        settings.key\r\n    ].join('|');\r\n\r\n    const storage = getRxStorageRemote({\r\n        identifier: 'electron-ipc-renderer',\r\n        mode: settings.mode,\r\n        messageChannelCreator() {\r\n            const messages$ = new Subject<MessageFromRemote>();\r\n            const listener = (_event: any, message: any) => {\r\n                messages$.next(message);\r\n            };\r\n            settings.ipcRenderer.on(channelId, listener);\r\n            settings.ipcRenderer.postMessage(\r\n                channelId,\r\n                false\r\n            );\r\n            return Promise.resolve({\r\n                messages$,\r\n                send(msg) {\r\n                    settings.ipcRenderer.postMessage(\r\n                        channelId,\r\n                        msg\r\n                    );\r\n                },\r\n                close() {\r\n                    settings.ipcRenderer.removeListener(channelId, listener);\r\n                    return PROMISE_RESOLVE_VOID;\r\n                }\r\n            });\r\n        },\r\n    });\r\n    return storage;\r\n}\r\n"],"mappings":";;;;;;AAAA,IAAAA,KAAA,GAAAC,OAAA;AACA,IAAAC,MAAA,GAAAD,OAAA;AAMA,IAAAE,eAAA,GAAAF,OAAA;AAGA,IAAAG,OAAA,GAAAH,OAAA;AAcO,SAASI,uBAAuBA,CACnCC,QAAsC,EAClB;EACpB,IAAMC,SAAS,GAAG,CACdC,uCAAuB,EACvBF,QAAQ,CAACG,GAAG,CACf,CAACC,IAAI,CAAC,GAAG,CAAC;EAEX,IAAMC,OAAO,GAAG,IAAAC,yBAAkB,EAAC;IAC/BC,UAAU,EAAE,uBAAuB;IACnCC,IAAI,EAAER,QAAQ,CAACQ,IAAI;IACnBC,qBAAqBA,CAAA,EAAG;MACpB,IAAMC,SAAS,GAAG,IAAIC,aAAO,CAAoB,CAAC;MAClD,IAAMC,QAAQ,GAAGA,CAACC,MAAW,EAAEC,OAAY,KAAK;QAC5CJ,SAAS,CAACK,IAAI,CAACD,OAAO,CAAC;MAC3B,CAAC;MACDd,QAAQ,CAACgB,WAAW,CAACC,EAAE,CAAChB,SAAS,EAAEW,QAAQ,CAAC;MAC5CZ,QAAQ,CAACgB,WAAW,CAACE,WAAW,CAC5BjB,SAAS,EACT,KACJ,CAAC;MACD,OAAOkB,OAAO,CAACC,OAAO,CAAC;QACnBV,SAAS;QACTW,IAAIA,CAACC,GAAG,EAAE;UACNtB,QAAQ,CAACgB,WAAW,CAACE,WAAW,CAC5BjB,SAAS,EACTqB,GACJ,CAAC;QACL,CAAC;QACDC,KAAKA,CAAA,EAAG;UACJvB,QAAQ,CAACgB,WAAW,CAACQ,cAAc,CAACvB,SAAS,EAAEW,QAAQ,CAAC;UACxD,OAAOa,4BAAoB;QAC/B;MACJ,CAAC,CAAC;IACN;EACJ,CAAC,CAAC;EACF,OAAOpB,OAAO;AAClB","ignoreList":[]}