{"version":3,"file":"index.js","names":["_rxQueryHelper","require","_mingoUpdater","incrementalUpdate","updateObj","incrementalModify","docData","newDocData","mingoUpdater","update","oldDocData","_data","_saveData","RxQueryUpdate","runQueryUpdateFunction","asRxQuery","doc","RxDBUpdatePlugin","exports","name","rxdb","prototypes","RxDocument","proto","RxQuery"],"sources":["../../../../src/plugins/update/index.ts"],"sourcesContent":["/**\r\n * this plugin allows delta-updates with mongo-like-syntax\r\n * It's using mingo internally\r\n * @link https://github.com/kofrasa/mingo\r\n */\r\nimport { runQueryUpdateFunction } from '../../rx-query-helper.ts';\r\nimport type {\r\n    RxDocument,\r\n    RxQuery,\r\n    RxPlugin,\r\n    UpdateQuery\r\n} from '../../types/index.d.ts';\r\nimport { mingoUpdater } from './mingo-updater.ts';\r\n\r\nexport function incrementalUpdate<RxDocType>(\r\n    this: RxDocument<RxDocType>,\r\n    updateObj: UpdateQuery<RxDocType>\r\n): Promise<RxDocument<RxDocType>> {\r\n    return this.incrementalModify((docData) => {\r\n        const newDocData = mingoUpdater<RxDocType>(docData, updateObj);\r\n        return newDocData;\r\n    });\r\n}\r\n\r\nexport function update<RxDocType>(\r\n    this: RxDocument<RxDocType>,\r\n    updateObj: UpdateQuery<RxDocType>\r\n): Promise<RxDocument<RxDocType>> {\r\n    const oldDocData = this._data;\r\n    const newDocData = mingoUpdater(oldDocData, updateObj);\r\n    return this._saveData(newDocData, oldDocData);\r\n}\r\n\r\nexport async function RxQueryUpdate(\r\n    this: RxQuery,\r\n    updateObj: UpdateQuery<any>\r\n): Promise<any> {\r\n    return runQueryUpdateFunction(\r\n        this.asRxQuery,\r\n        (doc) => doc.update(updateObj),\r\n    );\r\n}\r\n\r\n\r\nexport const RxDBUpdatePlugin: RxPlugin = {\r\n    name: 'update',\r\n    rxdb: true,\r\n    prototypes: {\r\n        RxDocument: (proto: any) => {\r\n            proto.update = update;\r\n            proto.incrementalUpdate = incrementalUpdate;\r\n        },\r\n        RxQuery: (proto: any) => {\r\n            proto.update = RxQueryUpdate;\r\n        }\r\n    }\r\n};\r\n"],"mappings":";;;;;;;;;AAKA,IAAAA,cAAA,GAAAC,OAAA;AAOA,IAAAC,aAAA,GAAAD,OAAA;AAZA;AACA;AACA;AACA;AACA;;AAUO,SAASE,iBAAiBA,CAE7BC,SAAiC,EACH;EAC9B,OAAO,IAAI,CAACC,iBAAiB,CAAEC,OAAO,IAAK;IACvC,IAAMC,UAAU,GAAG,IAAAC,0BAAY,EAAYF,OAAO,EAAEF,SAAS,CAAC;IAC9D,OAAOG,UAAU;EACrB,CAAC,CAAC;AACN;AAEO,SAASE,MAAMA,CAElBL,SAAiC,EACH;EAC9B,IAAMM,UAAU,GAAG,IAAI,CAACC,KAAK;EAC7B,IAAMJ,UAAU,GAAG,IAAAC,0BAAY,EAACE,UAAU,EAAEN,SAAS,CAAC;EACtD,OAAO,IAAI,CAACQ,SAAS,CAACL,UAAU,EAAEG,UAAU,CAAC;AACjD;AAEO,eAAeG,aAAaA,CAE/BT,SAA2B,EACf;EACZ,OAAO,IAAAU,qCAAsB,EACzB,IAAI,CAACC,SAAS,EACbC,GAAG,IAAKA,GAAG,CAACP,MAAM,CAACL,SAAS,CACjC,CAAC;AACL;AAGO,IAAMa,gBAA0B,GAAAC,OAAA,CAAAD,gBAAA,GAAG;EACtCE,IAAI,EAAE,QAAQ;EACdC,IAAI,EAAE,IAAI;EACVC,UAAU,EAAE;IACRC,UAAU,EAAGC,KAAU,IAAK;MACxBA,KAAK,CAACd,MAAM,GAAGA,MAAM;MACrBc,KAAK,CAACpB,iBAAiB,GAAGA,iBAAiB;IAC/C,CAAC;IACDqB,OAAO,EAAGD,KAAU,IAAK;MACrBA,KAAK,CAACd,MAAM,GAAGI,aAAa;IAChC;EACJ;AACJ,CAAC","ignoreList":[]}