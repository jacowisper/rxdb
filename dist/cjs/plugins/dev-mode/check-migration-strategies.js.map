{"version":3,"file":"check-migration-strategies.js","names":["_rxError","require","_rxSchema","checkMigrationStrategies","schema","migrationStrategies","Array","isArray","newRxTypeError","previousVersions","getPreviousVersions","length","Object","keys","newRxError","have","should","map","vNr","v","s","filter","strategy","forEach","version","type"],"sources":["../../../../src/plugins/dev-mode/check-migration-strategies.ts"],"sourcesContent":["import type { RxJsonSchema, NumberFunctionMap } from '../../types/index.d.ts';\r\nimport { newRxTypeError, newRxError } from '../../rx-error.ts';\r\nimport { getPreviousVersions } from '../../rx-schema.ts';\r\n\r\n\r\n/**\r\n * checks if the migrationStrategies are ok, throws if not\r\n * @throws {Error|TypeError} if not ok\r\n */\r\nexport function checkMigrationStrategies(\r\n    schema: RxJsonSchema<any>,\r\n    migrationStrategies: NumberFunctionMap\r\n): boolean {\r\n    // migrationStrategies must be object not array\r\n    if (\r\n        typeof migrationStrategies !== 'object' ||\r\n        Array.isArray(migrationStrategies)\r\n    ) {\r\n        throw newRxTypeError('COL11', {\r\n            schema\r\n        });\r\n    }\r\n\r\n    const previousVersions = getPreviousVersions(schema);\r\n\r\n    // for every previousVersion there must be strategy\r\n    if (\r\n        previousVersions.length !== Object\r\n            .keys(migrationStrategies).length\r\n    ) {\r\n        throw newRxError('COL12', {\r\n            have: Object.keys(migrationStrategies),\r\n            should: previousVersions\r\n        });\r\n    }\r\n\r\n    // every strategy must have number as property and be a function\r\n    previousVersions\r\n        .map(vNr => ({\r\n            v: vNr,\r\n            s: migrationStrategies[(vNr + 1)]\r\n        }))\r\n        .filter(strategy => typeof strategy.s !== 'function')\r\n        .forEach(strategy => {\r\n            throw newRxTypeError('COL13', {\r\n                version: strategy.v,\r\n                type: typeof strategy,\r\n                schema\r\n            });\r\n        });\r\n\r\n    return true;\r\n}\r\n"],"mappings":";;;;;;AACA,IAAAA,QAAA,GAAAC,OAAA;AACA,IAAAC,SAAA,GAAAD,OAAA;AAGA;AACA;AACA;AACA;AACO,SAASE,wBAAwBA,CACpCC,MAAyB,EACzBC,mBAAsC,EAC/B;EACP;EACA,IACI,OAAOA,mBAAmB,KAAK,QAAQ,IACvCC,KAAK,CAACC,OAAO,CAACF,mBAAmB,CAAC,EACpC;IACE,MAAM,IAAAG,uBAAc,EAAC,OAAO,EAAE;MAC1BJ;IACJ,CAAC,CAAC;EACN;EAEA,IAAMK,gBAAgB,GAAG,IAAAC,6BAAmB,EAACN,MAAM,CAAC;;EAEpD;EACA,IACIK,gBAAgB,CAACE,MAAM,KAAKC,MAAM,CAC7BC,IAAI,CAACR,mBAAmB,CAAC,CAACM,MAAM,EACvC;IACE,MAAM,IAAAG,mBAAU,EAAC,OAAO,EAAE;MACtBC,IAAI,EAAEH,MAAM,CAACC,IAAI,CAACR,mBAAmB,CAAC;MACtCW,MAAM,EAAEP;IACZ,CAAC,CAAC;EACN;;EAEA;EACAA,gBAAgB,CACXQ,GAAG,CAACC,GAAG,KAAK;IACTC,CAAC,EAAED,GAAG;IACNE,CAAC,EAAEf,mBAAmB,CAAEa,GAAG,GAAG,CAAC;EACnC,CAAC,CAAC,CAAC,CACFG,MAAM,CAACC,QAAQ,IAAI,OAAOA,QAAQ,CAACF,CAAC,KAAK,UAAU,CAAC,CACpDG,OAAO,CAACD,QAAQ,IAAI;IACjB,MAAM,IAAAd,uBAAc,EAAC,OAAO,EAAE;MAC1BgB,OAAO,EAAEF,QAAQ,CAACH,CAAC;MACnBM,IAAI,EAAE,OAAOH,QAAQ;MACrBlB;IACJ,CAAC,CAAC;EACN,CAAC,CAAC;EAEN,OAAO,IAAI;AACf","ignoreList":[]}