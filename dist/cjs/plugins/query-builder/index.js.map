{"version":3,"file":"index.js","names":["_nosqlQueryBuilder","require","Object","keys","forEach","key","prototype","hasOwnProperty","call","_exportNames","exports","defineProperty","enumerable","get","_rxQuery","_index","_overwritable","_rxError","RXQUERY_OTHER_FLAG","runBuildingStep","rxQuery","functionName","value","queryBuilder","createQueryBuilder","clone","mangoQuery","other","queryBuilderJson","toJSON","createRxQuery","op","query","collection","path","applyBuildingStep","proto","overwritable","isDevMode","newRxError","name","RxDBQueryBuilderPlugin","rxdb","prototypes","RxQuery","attribute","OTHER_MANGO_ATTRIBUTES","OTHER_MANGO_OPERATORS","operator"],"sources":["../../../../src/plugins/query-builder/index.ts"],"sourcesContent":["import {\r\n    createQueryBuilder,\r\n    OTHER_MANGO_ATTRIBUTES,\r\n    OTHER_MANGO_OPERATORS\r\n} from './mquery/nosql-query-builder.ts';\r\nimport type { RxPlugin, RxQuery } from '../../types/index.d.ts';\r\nimport { createRxQuery } from '../../rx-query.ts';\r\nimport { clone } from '../../plugins/utils/index.ts';\r\nimport { overwritable } from '../../overwritable.ts';\r\nimport { newRxError } from '../../rx-error.ts';\r\n\r\n// if the query-builder plugin is used, we have to save its last path\r\nconst RXQUERY_OTHER_FLAG = 'queryBuilderPath';\r\n\r\nexport function runBuildingStep<RxDocumentType, RxQueryResult>(\r\n    rxQuery: RxQuery<RxDocumentType, RxQueryResult>,\r\n    functionName: string,\r\n    value: any\r\n): RxQuery<RxDocumentType, RxQueryResult> {\r\n    const queryBuilder = createQueryBuilder(clone(rxQuery.mangoQuery), rxQuery.other[RXQUERY_OTHER_FLAG]);\r\n\r\n    (queryBuilder as any)[functionName](value); // run\r\n\r\n    const queryBuilderJson = queryBuilder.toJSON();\r\n\r\n    return createRxQuery<RxDocumentType>(\r\n        rxQuery.op,\r\n        queryBuilderJson.query,\r\n        rxQuery.collection,\r\n        {\r\n            ...rxQuery.other,\r\n            [RXQUERY_OTHER_FLAG]: queryBuilderJson.path\r\n        }\r\n    ) as RxQuery<RxDocumentType>;\r\n}\r\n\r\nexport function applyBuildingStep(\r\n    proto: any,\r\n    functionName: string\r\n): void {\r\n    proto[functionName] = function (this: RxQuery, value: any) {\r\n        if (overwritable.isDevMode() && this.op === 'findByIds') {\r\n            throw newRxError('QU17', {\r\n                collection: this.collection.name,\r\n                query: this.mangoQuery\r\n            });\r\n        }\r\n        return runBuildingStep(this, functionName, value);\r\n    };\r\n}\r\n\r\nexport * from './mquery/nosql-query-builder.ts';\r\n\r\nexport const RxDBQueryBuilderPlugin: RxPlugin = {\r\n    name: 'query-builder',\r\n    rxdb: true,\r\n    prototypes: {\r\n        RxQuery(proto: any) {\r\n            [\r\n                'where',\r\n                'equals',\r\n                'eq',\r\n                'or',\r\n                'nor',\r\n                'and',\r\n                'mod',\r\n                'exists',\r\n                'elemMatch',\r\n                'sort'\r\n            ].forEach(attribute => {\r\n                applyBuildingStep(proto, attribute);\r\n            });\r\n            OTHER_MANGO_ATTRIBUTES.forEach(attribute => {\r\n                applyBuildingStep(proto, attribute);\r\n            });\r\n            OTHER_MANGO_OPERATORS.forEach(operator => {\r\n                applyBuildingStep(proto, operator);\r\n            });\r\n        }\r\n    }\r\n};\r\n"],"mappings":";;;;;;;;;;;;;AAAA,IAAAA,kBAAA,GAAAC,OAAA;AAmDAC,MAAA,CAAAC,IAAA,CAAAH,kBAAA,EAAAI,OAAA,WAAAC,GAAA;EAAA,IAAAA,GAAA,kBAAAA,GAAA;EAAA,IAAAH,MAAA,CAAAI,SAAA,CAAAC,cAAA,CAAAC,IAAA,CAAAC,YAAA,EAAAJ,GAAA;EAAA,IAAAA,GAAA,IAAAK,OAAA,IAAAA,OAAA,CAAAL,GAAA,MAAAL,kBAAA,CAAAK,GAAA;EAAAH,MAAA,CAAAS,cAAA,CAAAD,OAAA,EAAAL,GAAA;IAAAO,UAAA;IAAAC,GAAA,WAAAA,CAAA;MAAA,OAAAb,kBAAA,CAAAK,GAAA;IAAA;EAAA;AAAA;AA7CA,IAAAS,QAAA,GAAAb,OAAA;AACA,IAAAc,MAAA,GAAAd,OAAA;AACA,IAAAe,aAAA,GAAAf,OAAA;AACA,IAAAgB,QAAA,GAAAhB,OAAA;AAEA;AACA,IAAMiB,kBAAkB,GAAG,kBAAkB;AAEtC,SAASC,eAAeA,CAC3BC,OAA+C,EAC/CC,YAAoB,EACpBC,KAAU,EAC4B;EACtC,IAAMC,YAAY,GAAG,IAAAC,qCAAkB,EAAC,IAAAC,YAAK,EAACL,OAAO,CAACM,UAAU,CAAC,EAAEN,OAAO,CAACO,KAAK,CAACT,kBAAkB,CAAC,CAAC;EAEpGK,YAAY,CAASF,YAAY,CAAC,CAACC,KAAK,CAAC,CAAC,CAAC;;EAE5C,IAAMM,gBAAgB,GAAGL,YAAY,CAACM,MAAM,CAAC,CAAC;EAE9C,OAAO,IAAAC,sBAAa,EAChBV,OAAO,CAACW,EAAE,EACVH,gBAAgB,CAACI,KAAK,EACtBZ,OAAO,CAACa,UAAU,EAClB;IACI,GAAGb,OAAO,CAACO,KAAK;IAChB,CAACT,kBAAkB,GAAGU,gBAAgB,CAACM;EAC3C,CACJ,CAAC;AACL;AAEO,SAASC,iBAAiBA,CAC7BC,KAAU,EACVf,YAAoB,EAChB;EACJe,KAAK,CAACf,YAAY,CAAC,GAAG,UAAyBC,KAAU,EAAE;IACvD,IAAIe,0BAAY,CAACC,SAAS,CAAC,CAAC,IAAI,IAAI,CAACP,EAAE,KAAK,WAAW,EAAE;MACrD,MAAM,IAAAQ,mBAAU,EAAC,MAAM,EAAE;QACrBN,UAAU,EAAE,IAAI,CAACA,UAAU,CAACO,IAAI;QAChCR,KAAK,EAAE,IAAI,CAACN;MAChB,CAAC,CAAC;IACN;IACA,OAAOP,eAAe,CAAC,IAAI,EAAEE,YAAY,EAAEC,KAAK,CAAC;EACrD,CAAC;AACL;AAIO,IAAMmB,sBAAgC,GAAA/B,OAAA,CAAA+B,sBAAA,GAAG;EAC5CD,IAAI,EAAE,eAAe;EACrBE,IAAI,EAAE,IAAI;EACVC,UAAU,EAAE;IACRC,OAAOA,CAACR,KAAU,EAAE;MAChB,CACI,OAAO,EACP,QAAQ,EACR,IAAI,EACJ,IAAI,EACJ,KAAK,EACL,KAAK,EACL,KAAK,EACL,QAAQ,EACR,WAAW,EACX,MAAM,CACT,CAAChC,OAAO,CAACyC,SAAS,IAAI;QACnBV,iBAAiB,CAACC,KAAK,EAAES,SAAS,CAAC;MACvC,CAAC,CAAC;MACFC,yCAAsB,CAAC1C,OAAO,CAACyC,SAAS,IAAI;QACxCV,iBAAiB,CAACC,KAAK,EAAES,SAAS,CAAC;MACvC,CAAC,CAAC;MACFE,wCAAqB,CAAC3C,OAAO,CAAC4C,QAAQ,IAAI;QACtCb,iBAAiB,CAACC,KAAK,EAAEY,QAAQ,CAAC;MACtC,CAAC,CAAC;IACN;EACJ;AACJ,CAAC","ignoreList":[]}