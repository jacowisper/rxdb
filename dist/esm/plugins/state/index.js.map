{"version":3,"file":"index.js","names":["getFromMapOrCreate","createRxState","STATE_BY_DATABASE","WeakMap","addState","namespace","stateCache","Map","state","states","RxDBStatePlugin","name","rxdb","prototypes","RxDatabase","proto"],"sources":["../../../../src/plugins/state/index.ts"],"sourcesContent":["import type {\r\n    RxDatabase,\r\n    RxPlugin,\r\n    RxState\r\n} from '../../types/index.d.ts';\r\nimport { getFromMapOrCreate } from '../utils/utils-map.ts';\r\nimport { RxStateBase, createRxState } from './rx-state.ts';\r\n\r\nexport * from './helpers.ts';\r\n\r\ntype StateByPrefix = Map<string, Promise<RxStateBase<any>>>;\r\nconst STATE_BY_DATABASE = new WeakMap<RxDatabase, StateByPrefix>();\r\n\r\nexport async function addState<T>(\r\n    this: RxDatabase,\r\n    namespace: string = ''\r\n): Promise<RxState<T>> {\r\n    const stateCache = getFromMapOrCreate<RxDatabase, StateByPrefix>(\r\n        STATE_BY_DATABASE,\r\n        this,\r\n        () => new Map()\r\n    );\r\n    const state = await getFromMapOrCreate(\r\n        stateCache,\r\n        namespace,\r\n        () => createRxState<T>(this, namespace)\r\n    );\r\n    this.states[namespace] = state;\r\n    return state as any;\r\n}\r\n\r\nexport const RxDBStatePlugin: RxPlugin = {\r\n    name: 'state',\r\n    rxdb: true,\r\n    prototypes: {\r\n        RxDatabase(proto: any) {\r\n            proto.addState = addState;\r\n        }\r\n    }\r\n};\r\n"],"mappings":"AAKA,SAASA,kBAAkB,QAAQ,uBAAuB;AAC1D,SAAsBC,aAAa,QAAQ,eAAe;AAE1D,cAAc,cAAc;AAG5B,IAAMC,iBAAiB,GAAG,IAAIC,OAAO,CAA4B,CAAC;AAElE,OAAO,eAAeC,QAAQA,CAE1BC,SAAiB,GAAG,EAAE,EACH;EACnB,IAAMC,UAAU,GAAGN,kBAAkB,CACjCE,iBAAiB,EACjB,IAAI,EACJ,MAAM,IAAIK,GAAG,CAAC,CAClB,CAAC;EACD,IAAMC,KAAK,GAAG,MAAMR,kBAAkB,CAClCM,UAAU,EACVD,SAAS,EACT,MAAMJ,aAAa,CAAI,IAAI,EAAEI,SAAS,CAC1C,CAAC;EACD,IAAI,CAACI,MAAM,CAACJ,SAAS,CAAC,GAAGG,KAAK;EAC9B,OAAOA,KAAK;AAChB;AAEA,OAAO,IAAME,eAAyB,GAAG;EACrCC,IAAI,EAAE,OAAO;EACbC,IAAI,EAAE,IAAI;EACVC,UAAU,EAAE;IACRC,UAAUA,CAACC,KAAU,EAAE;MACnBA,KAAK,CAACX,QAAQ,GAAGA,QAAQ;IAC7B;EACJ;AACJ,CAAC","ignoreList":[]}