{"version":3,"file":"index.js","names":["Ajv","wrappedValidateStorageFactory","ajv","getAjv","strict","addKeyword","getValidator","schema","validator","compile","docData","isValid","errors","wrappedValidateAjvStorage"],"sources":["../../../../src/plugins/validate-ajv/index.ts"],"sourcesContent":["/**\r\n * this plugin validates documents before they can be inserted into the RxCollection.\r\n * It's using ajv as jsonschema-validator\r\n * @link https://github.com/epoberezkin/ajv\r\n * @link https://github.com/ajv-validator/ajv/issues/2132#issuecomment-1537224620\r\n */\r\nimport Ajv from 'ajv';\r\nimport type {\r\n    RxDocumentData,\r\n    RxJsonSchema\r\n} from '../../types/index.d.ts';\r\nimport { wrappedValidateStorageFactory } from '../../plugin-helpers.ts';\r\n\r\n\r\nlet ajv: Ajv;\r\n\r\n\r\nexport function getAjv() {\r\n    if (!ajv) {\r\n        ajv = new Ajv({\r\n            strict: true\r\n        });\r\n        ajv.addKeyword('version');\r\n        ajv.addKeyword('keyCompression');\r\n        ajv.addKeyword('primaryKey');\r\n        ajv.addKeyword('indexes');\r\n        ajv.addKeyword('encrypted');\r\n        ajv.addKeyword('final');\r\n        ajv.addKeyword('sharding');\r\n        ajv.addKeyword('internalIndexes');\r\n        ajv.addKeyword('attachments');\r\n        ajv.addKeyword('ref');\r\n        ajv.addKeyword('crdt');\r\n    }\r\n    return ajv;\r\n}\r\n\r\n\r\n\r\nexport function getValidator(\r\n    schema: RxJsonSchema<any>\r\n) {\r\n    const validator = getAjv().compile(schema);\r\n    return (docData: RxDocumentData<any>) => {\r\n        const isValid = validator(docData);\r\n        if (isValid) {\r\n            return [];\r\n        } else {\r\n            return validator.errors as any;\r\n        }\r\n    };\r\n}\r\n\r\n\r\n\r\nexport const wrappedValidateAjvStorage = wrappedValidateStorageFactory(\r\n    getValidator,\r\n    'ajv'\r\n);\r\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA,OAAOA,GAAG,MAAM,KAAK;AAKrB,SAASC,6BAA6B,QAAQ,yBAAyB;AAGvE,IAAIC,GAAQ;AAGZ,OAAO,SAASC,MAAMA,CAAA,EAAG;EACrB,IAAI,CAACD,GAAG,EAAE;IACNA,GAAG,GAAG,IAAIF,GAAG,CAAC;MACVI,MAAM,EAAE;IACZ,CAAC,CAAC;IACFF,GAAG,CAACG,UAAU,CAAC,SAAS,CAAC;IACzBH,GAAG,CAACG,UAAU,CAAC,gBAAgB,CAAC;IAChCH,GAAG,CAACG,UAAU,CAAC,YAAY,CAAC;IAC5BH,GAAG,CAACG,UAAU,CAAC,SAAS,CAAC;IACzBH,GAAG,CAACG,UAAU,CAAC,WAAW,CAAC;IAC3BH,GAAG,CAACG,UAAU,CAAC,OAAO,CAAC;IACvBH,GAAG,CAACG,UAAU,CAAC,UAAU,CAAC;IAC1BH,GAAG,CAACG,UAAU,CAAC,iBAAiB,CAAC;IACjCH,GAAG,CAACG,UAAU,CAAC,aAAa,CAAC;IAC7BH,GAAG,CAACG,UAAU,CAAC,KAAK,CAAC;IACrBH,GAAG,CAACG,UAAU,CAAC,MAAM,CAAC;EAC1B;EACA,OAAOH,GAAG;AACd;AAIA,OAAO,SAASI,YAAYA,CACxBC,MAAyB,EAC3B;EACE,IAAMC,SAAS,GAAGL,MAAM,CAAC,CAAC,CAACM,OAAO,CAACF,MAAM,CAAC;EAC1C,OAAQG,OAA4B,IAAK;IACrC,IAAMC,OAAO,GAAGH,SAAS,CAACE,OAAO,CAAC;IAClC,IAAIC,OAAO,EAAE;MACT,OAAO,EAAE;IACb,CAAC,MAAM;MACH,OAAOH,SAAS,CAACI,MAAM;IAC3B;EACJ,CAAC;AACL;AAIA,OAAO,IAAMC,yBAAyB,GAAGZ,6BAA6B,CAClEK,YAAY,EACZ,KACJ,CAAC","ignoreList":[]}