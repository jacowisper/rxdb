{"version":3,"file":"utils-revision.js","names":["parseRevision","revision","split","length","Error","height","parseInt","hash","getHeightOfRevision","useChars","index","char","createRevision","databaseInstanceToken","previousDocData","newRevisionHeight","_rev"],"sources":["../../../../src/plugins/utils/utils-revision.ts"],"sourcesContent":["import type {\r\n    RxDocumentData\r\n} from '../../types/index.d.ts';\r\n\r\n/**\r\n * Parses the full revision.\r\n * Do NOT use this if you only need the revision height,\r\n * then use getHeightOfRevision() instead which is faster.\r\n */\r\nexport function parseRevision(revision: string): { height: number; hash: string; } {\r\n    const split = revision.split('-');\r\n    if (split.length !== 2) {\r\n        throw new Error('malformatted revision: ' + revision);\r\n    }\r\n    return {\r\n        height: parseInt(split[0], 10),\r\n        hash: split[1]\r\n    };\r\n}\r\n\r\n/**\r\n * @hotPath Performance is very important here\r\n * because we need to parse the revision height very often.\r\n * Do not use `parseInt(revision.split('-')[0], 10)` because\r\n * only fetching the start-number chars is faster.\r\n */\r\nexport function getHeightOfRevision(revision: string): number {\r\n    let useChars = '';\r\n    for (let index = 0; index < revision.length; index++) {\r\n        const char = revision[index];\r\n        if (char === '-') {\r\n            return parseInt(useChars, 10);\r\n        }\r\n        useChars += char;\r\n    }\r\n    throw new Error('malformatted revision: ' + revision);\r\n}\r\n\r\n\r\n/**\r\n * Creates the next write revision for a given document.\r\n */\r\nexport function createRevision<RxDocType>(\r\n    databaseInstanceToken: string,\r\n    previousDocData?: RxDocumentData<RxDocType>\r\n): string {\r\n    const newRevisionHeight = !previousDocData ? 1 : getHeightOfRevision(previousDocData._rev) + 1\r\n    return newRevisionHeight + '-' + databaseInstanceToken;\r\n}\r\n\r\n"],"mappings":"AAIA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASA,aAAaA,CAACC,QAAgB,EAAqC;EAC/E,IAAMC,KAAK,GAAGD,QAAQ,CAACC,KAAK,CAAC,GAAG,CAAC;EACjC,IAAIA,KAAK,CAACC,MAAM,KAAK,CAAC,EAAE;IACpB,MAAM,IAAIC,KAAK,CAAC,yBAAyB,GAAGH,QAAQ,CAAC;EACzD;EACA,OAAO;IACHI,MAAM,EAAEC,QAAQ,CAACJ,KAAK,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC;IAC9BK,IAAI,EAAEL,KAAK,CAAC,CAAC;EACjB,CAAC;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASM,mBAAmBA,CAACP,QAAgB,EAAU;EAC1D,IAAIQ,QAAQ,GAAG,EAAE;EACjB,KAAK,IAAIC,KAAK,GAAG,CAAC,EAAEA,KAAK,GAAGT,QAAQ,CAACE,MAAM,EAAEO,KAAK,EAAE,EAAE;IAClD,IAAMC,IAAI,GAAGV,QAAQ,CAACS,KAAK,CAAC;IAC5B,IAAIC,IAAI,KAAK,GAAG,EAAE;MACd,OAAOL,QAAQ,CAACG,QAAQ,EAAE,EAAE,CAAC;IACjC;IACAA,QAAQ,IAAIE,IAAI;EACpB;EACA,MAAM,IAAIP,KAAK,CAAC,yBAAyB,GAAGH,QAAQ,CAAC;AACzD;;AAGA;AACA;AACA;AACA,OAAO,SAASW,cAAcA,CAC1BC,qBAA6B,EAC7BC,eAA2C,EACrC;EACN,IAAMC,iBAAiB,GAAG,CAACD,eAAe,GAAG,CAAC,GAAGN,mBAAmB,CAACM,eAAe,CAACE,IAAI,CAAC,GAAG,CAAC;EAC9F,OAAOD,iBAAiB,GAAG,GAAG,GAAGF,qBAAqB;AAC1D","ignoreList":[]}