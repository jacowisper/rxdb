{"version":3,"file":"firestore-types.js","names":[],"sources":["../../../../src/plugins/replication-firestore/firestore-types.ts"],"sourcesContent":["import type {\r\n    MaybePromise,\r\n    ReplicationOptions,\r\n    ReplicationPullOptions,\r\n    ReplicationPushOptions,\r\n    WithDeleted\r\n} from '../../types/index.d.ts';\r\n\r\nimport type {\r\n    CollectionReference,\r\n    Firestore,\r\n    QueryFieldFilterConstraint,\r\n    QuerySnapshot\r\n} from 'firebase/firestore';\r\n\r\nexport type FirestoreCheckpointType = {\r\n    id: string;\r\n    /**\r\n     * Firestore internally sets the time to an object like\r\n     * {\r\n     *       \"seconds\": 1669807105,\r\n     *       \"nanoseconds\": 476000000\r\n     * }\r\n     * But to be able to query that, we have to use a date string\r\n     * like '2022-11-30T11:18:25.141Z'\r\n     * so we store that string instead.\r\n     */\r\n    serverTimestamp: string;\r\n};\r\nexport type FirestoreCollection<RxDocType> = CollectionReference<RxDocType>;\r\n\r\nexport type FirestoreOptions<RxDocType> = {\r\n    projectId: string;\r\n    collection: FirestoreCollection<RxDocType>;\r\n    database: Firestore;\r\n};\r\n\r\nexport type FirestoreSyncPullOptions<RxDocType> =\r\n    Omit<ReplicationPullOptions<RxDocType, FirestoreCheckpointType>, 'handler' | 'stream$'>\r\n    & {\r\n        filter?: QueryFieldFilterConstraint | QueryFieldFilterConstraint[];\r\n    };\r\n\r\nexport type FirestoreSyncPushOptions<RxDocType> = Omit<ReplicationPushOptions<RxDocType>, 'handler'>\r\n    & {\r\n        filter?(item: WithDeleted<RxDocType>): MaybePromise<boolean>;\r\n    };\r\n\r\nexport type SyncOptionsFirestore<RxDocType> = Omit<\r\n    ReplicationOptions<RxDocType, any>,\r\n    'pull' | 'push'\r\n> & {\r\n    firestore: FirestoreOptions<RxDocType>;\r\n    /**\r\n     * In firestore it is not possible to read out\r\n     * the internally used write timestamp.\r\n     * Even if we could read it out, it is not indexed which\r\n     * is required for fetch 'changes-since-x'.\r\n     * So instead we have to rely on a custom user defined field\r\n     * that contains the server time which is set by firestore via serverTimestamp()\r\n     * IMPORTANT: The serverTimestampField MUST NOT be part of the collections RxJsonSchema!\r\n     * [default='serverTimestamp']\r\n     * @link https://groups.google.com/g/firebase-talk/c/tAmPzPei-mE\r\n     */\r\n    serverTimestampField?: string;\r\n    pull?: FirestoreSyncPullOptions<RxDocType>;\r\n    push?: FirestoreSyncPushOptions<RxDocType>;\r\n};\r\n\r\nexport type GetQuery<RxDocType> = (ids: string[]) => Promise<QuerySnapshot<RxDocType>>;\r\n"],"mappings":"","ignoreList":[]}