{"version":3,"file":"rx-storage-ipc-renderer.js","names":["Subject","getRxStorageRemote","IPC_RENDERER_KEY_PREFIX","PROMISE_RESOLVE_VOID","getRxStorageIpcRenderer","settings","channelId","key","join","storage","identifier","mode","messageChannelCreator","messages$","listener","_event","message","next","ipcRenderer","on","postMessage","Promise","resolve","send","msg","close","removeListener"],"sources":["../../../../src/plugins/electron/rx-storage-ipc-renderer.ts"],"sourcesContent":["import { Subject } from 'rxjs';\r\nimport {\r\n    getRxStorageRemote,\r\n    RxStorageRemote,\r\n    RxStorageRemoteSettings,\r\n    MessageFromRemote\r\n} from '../storage-remote/index.ts';\r\nimport {\r\n    IPC_RENDERER_KEY_PREFIX\r\n} from './electron-helper.ts';\r\nimport { PROMISE_RESOLVE_VOID } from '../utils/index.ts';\r\n\r\nexport type RxStorageIpcRendererSettings = {\r\n    /**\r\n     * Set the same key on both sides\r\n     * to ensure that messages do not get mixed\r\n     * up when you use more then one storage.\r\n     */\r\n    key: string;\r\n    ipcRenderer: any;\r\n    mode: RxStorageRemoteSettings['mode'];\r\n};\r\n\r\nexport type RxStorageIpcRenderer = RxStorageRemote;\r\nexport function getRxStorageIpcRenderer(\r\n    settings: RxStorageIpcRendererSettings\r\n): RxStorageIpcRenderer {\r\n    const channelId = [\r\n        IPC_RENDERER_KEY_PREFIX,\r\n        settings.key\r\n    ].join('|');\r\n\r\n    const storage = getRxStorageRemote({\r\n        identifier: 'electron-ipc-renderer',\r\n        mode: settings.mode,\r\n        messageChannelCreator() {\r\n            const messages$ = new Subject<MessageFromRemote>();\r\n            const listener = (_event: any, message: any) => {\r\n                messages$.next(message);\r\n            };\r\n            settings.ipcRenderer.on(channelId, listener);\r\n            settings.ipcRenderer.postMessage(\r\n                channelId,\r\n                false\r\n            );\r\n            return Promise.resolve({\r\n                messages$,\r\n                send(msg) {\r\n                    settings.ipcRenderer.postMessage(\r\n                        channelId,\r\n                        msg\r\n                    );\r\n                },\r\n                close() {\r\n                    settings.ipcRenderer.removeListener(channelId, listener);\r\n                    return PROMISE_RESOLVE_VOID;\r\n                }\r\n            });\r\n        },\r\n    });\r\n    return storage;\r\n}\r\n"],"mappings":"AAAA,SAASA,OAAO,QAAQ,MAAM;AAC9B,SACIC,kBAAkB,QAIf,4BAA4B;AACnC,SACIC,uBAAuB,QACpB,sBAAsB;AAC7B,SAASC,oBAAoB,QAAQ,mBAAmB;AAcxD,OAAO,SAASC,uBAAuBA,CACnCC,QAAsC,EAClB;EACpB,IAAMC,SAAS,GAAG,CACdJ,uBAAuB,EACvBG,QAAQ,CAACE,GAAG,CACf,CAACC,IAAI,CAAC,GAAG,CAAC;EAEX,IAAMC,OAAO,GAAGR,kBAAkB,CAAC;IAC/BS,UAAU,EAAE,uBAAuB;IACnCC,IAAI,EAAEN,QAAQ,CAACM,IAAI;IACnBC,qBAAqBA,CAAA,EAAG;MACpB,IAAMC,SAAS,GAAG,IAAIb,OAAO,CAAoB,CAAC;MAClD,IAAMc,QAAQ,GAAGA,CAACC,MAAW,EAAEC,OAAY,KAAK;QAC5CH,SAAS,CAACI,IAAI,CAACD,OAAO,CAAC;MAC3B,CAAC;MACDX,QAAQ,CAACa,WAAW,CAACC,EAAE,CAACb,SAAS,EAAEQ,QAAQ,CAAC;MAC5CT,QAAQ,CAACa,WAAW,CAACE,WAAW,CAC5Bd,SAAS,EACT,KACJ,CAAC;MACD,OAAOe,OAAO,CAACC,OAAO,CAAC;QACnBT,SAAS;QACTU,IAAIA,CAACC,GAAG,EAAE;UACNnB,QAAQ,CAACa,WAAW,CAACE,WAAW,CAC5Bd,SAAS,EACTkB,GACJ,CAAC;QACL,CAAC;QACDC,KAAKA,CAAA,EAAG;UACJpB,QAAQ,CAACa,WAAW,CAACQ,cAAc,CAACpB,SAAS,EAAEQ,QAAQ,CAAC;UACxD,OAAOX,oBAAoB;QAC/B;MACJ,CAAC,CAAC;IACN;EACJ,CAAC,CAAC;EACF,OAAOM,OAAO;AAClB","ignoreList":[]}