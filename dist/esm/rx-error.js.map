{"version":3,"file":"rx-error.js","names":["overwritable","parametersToString","parameters","ret","Object","keys","length","repeat","map","k","paramStr","err","JSON","stringify","getOwnPropertyNames","_k","v","undefined","e","join","messageForError","message","code","RxError","_Error","_this","mes","call","url","getErrorUrl","rxdb","_inheritsLoose","_proto","prototype","toString","_createClass","key","get","_wrapNativeSuper","Error","RxTypeError","_TypeError","_this2","_proto2","TypeError","errorUrlHint","newRxError","tunnelErrorMessage","newRxTypeError","isBulkWriteConflictError","status","STORAGE_WRITE_ERROR_CODE_TO_MESSAGE","rxStorageWriteErrorToRxError","name","document","documentId","writeError"],"sources":["../../src/rx-error.ts"],"sourcesContent":["/**\r\n * here we use custom errors with the additional field 'parameters'\r\n */\r\n\r\nimport { overwritable } from './overwritable.ts';\r\nimport type {\r\n    RxErrorParameters,\r\n    RxErrorKey,\r\n    RxStorageWriteError,\r\n    RxStorageWriteErrorConflict\r\n} from './types/index.d.ts';\r\n\r\n/**\r\n * transform an object of parameters to a presentable string\r\n */\r\nfunction parametersToString(parameters: any): string {\r\n    let ret = '';\r\n    if (Object.keys(parameters).length === 0)\r\n        return ret;\r\n    ret +='-'.repeat(20) + '\\n';\r\n    ret += 'Parameters:\\n';\r\n    ret += Object.keys(parameters)\r\n        .map(k => {\r\n            let paramStr = '[object Object]';\r\n            try {\r\n                if (k === 'errors') {\r\n                    paramStr = parameters[k].map((err: any) => JSON.stringify(err, Object.getOwnPropertyNames(err)));\r\n                } else {\r\n                    paramStr = JSON.stringify(parameters[k], function (_k, v) {\r\n                        return v === undefined ? null : v;\r\n                    }, 2);\r\n                }\r\n            } catch (e) { }\r\n            return k + ': ' + paramStr;\r\n        })\r\n        .join('\\n');\r\n    ret += '\\n';\r\n    return ret;\r\n}\r\n\r\nfunction messageForError(\r\n    message: string,\r\n    code: string,\r\n    parameters: any\r\n): string {\r\n    return '' + '\\n' +\r\n        message + '\\n' +\r\n        parametersToString(parameters);\r\n}\r\n\r\nexport class RxError extends Error {\r\n    public code: RxErrorKey;\r\n    public message: string;\r\n    public url: string;\r\n    public parameters: RxErrorParameters;\r\n    // always true, use this to detect if its an rxdb-error\r\n    public rxdb: true;\r\n    constructor(\r\n        code: RxErrorKey,\r\n        message: string,\r\n        parameters: RxErrorParameters = {}\r\n    ) {\r\n        const mes = messageForError(message, code, parameters);\r\n        super(mes);\r\n        this.code = code;\r\n        this.message = mes;\r\n        this.url = getErrorUrl(code);\r\n        this.parameters = parameters;\r\n        this.rxdb = true; // tag them as internal\r\n    }\r\n    get name(): string {\r\n        return 'RxError (' + this.code + ')';\r\n    }\r\n    toString(): string {\r\n        return this.message;\r\n    }\r\n    get typeError(): boolean {\r\n        return false;\r\n    }\r\n}\r\n\r\nexport class RxTypeError extends TypeError {\r\n    public code: RxErrorKey;\r\n    public message: string;\r\n    public url: string;\r\n    public parameters: RxErrorParameters;\r\n    // always true, use this to detect if its an rxdb-error\r\n    public rxdb: true;\r\n    constructor(\r\n        code: RxErrorKey,\r\n        message: string,\r\n        parameters: RxErrorParameters = {}\r\n    ) {\r\n        const mes = messageForError(message, code, parameters);\r\n        super(mes);\r\n        this.code = code;\r\n        this.message = mes;\r\n        this.url = getErrorUrl(code);\r\n        this.parameters = parameters;\r\n        this.rxdb = true; // tag them as internal\r\n    }\r\n    get name(): string {\r\n        return 'RxTypeError (' + this.code + ')';\r\n    }\r\n    toString(): string {\r\n        return this.message;\r\n    }\r\n    get typeError(): boolean {\r\n        return true;\r\n    }\r\n}\r\n\r\n\r\nexport function getErrorUrl(code: RxErrorKey) {\r\n    return 'https://rxdb.info/errors.html?console=errors#' + code;\r\n}\r\n\r\nexport function errorUrlHint(code: RxErrorKey) {\r\n    return '\\nFind out more about this error here: ' + getErrorUrl(code) + ' \\n';\r\n}\r\n\r\nexport function newRxError(\r\n    code: RxErrorKey,\r\n    parameters?: RxErrorParameters\r\n): RxError {\r\n    return new RxError(\r\n        code,\r\n        overwritable.tunnelErrorMessage(code) + errorUrlHint(code),\r\n        parameters\r\n    );\r\n}\r\n\r\nexport function newRxTypeError(\r\n    code: RxErrorKey,\r\n    parameters?: RxErrorParameters\r\n): RxTypeError {\r\n    return new RxTypeError(\r\n        code,\r\n        overwritable.tunnelErrorMessage(code) + errorUrlHint(code),\r\n        parameters\r\n    );\r\n}\r\n\r\n\r\n/**\r\n * Returns the error if it is a 409 conflict,\r\n * return false if it is another error.\r\n */\r\nexport function isBulkWriteConflictError<RxDocType>(\r\n    err?: RxStorageWriteError<RxDocType> | any\r\n): RxStorageWriteErrorConflict<RxDocType> | false {\r\n    if (\r\n        err &&\r\n        err.status === 409\r\n    ) {\r\n        return err;\r\n    } else {\r\n        return false;\r\n    }\r\n}\r\n\r\n\r\nconst STORAGE_WRITE_ERROR_CODE_TO_MESSAGE: { [k: number]: string; } = {\r\n    409: 'document write conflict',\r\n    422: 'schema validation error',\r\n    510: 'attachment data missing'\r\n};\r\n\r\nexport function rxStorageWriteErrorToRxError(err: RxStorageWriteError<any>): RxError {\r\n    return newRxError('COL20', {\r\n        name: STORAGE_WRITE_ERROR_CODE_TO_MESSAGE[err.status],\r\n        document: err.documentId,\r\n        writeError: err\r\n    });\r\n}\r\n"],"mappings":";;;AAAA;AACA;AACA;;AAEA,SAASA,YAAY,QAAQ,mBAAmB;AAQhD;AACA;AACA;AACA,SAASC,kBAAkBA,CAACC,UAAe,EAAU;EACjD,IAAIC,GAAG,GAAG,EAAE;EACZ,IAAIC,MAAM,CAACC,IAAI,CAACH,UAAU,CAAC,CAACI,MAAM,KAAK,CAAC,EACpC,OAAOH,GAAG;EACdA,GAAG,IAAG,GAAG,CAACI,MAAM,CAAC,EAAE,CAAC,GAAG,IAAI;EAC3BJ,GAAG,IAAI,eAAe;EACtBA,GAAG,IAAIC,MAAM,CAACC,IAAI,CAACH,UAAU,CAAC,CACzBM,GAAG,CAACC,CAAC,IAAI;IACN,IAAIC,QAAQ,GAAG,iBAAiB;IAChC,IAAI;MACA,IAAID,CAAC,KAAK,QAAQ,EAAE;QAChBC,QAAQ,GAAGR,UAAU,CAACO,CAAC,CAAC,CAACD,GAAG,CAAEG,GAAQ,IAAKC,IAAI,CAACC,SAAS,CAACF,GAAG,EAAEP,MAAM,CAACU,mBAAmB,CAACH,GAAG,CAAC,CAAC,CAAC;MACpG,CAAC,MAAM;QACHD,QAAQ,GAAGE,IAAI,CAACC,SAAS,CAACX,UAAU,CAACO,CAAC,CAAC,EAAE,UAAUM,EAAE,EAAEC,CAAC,EAAE;UACtD,OAAOA,CAAC,KAAKC,SAAS,GAAG,IAAI,GAAGD,CAAC;QACrC,CAAC,EAAE,CAAC,CAAC;MACT;IACJ,CAAC,CAAC,OAAOE,CAAC,EAAE,CAAE;IACd,OAAOT,CAAC,GAAG,IAAI,GAAGC,QAAQ;EAC9B,CAAC,CAAC,CACDS,IAAI,CAAC,IAAI,CAAC;EACfhB,GAAG,IAAI,IAAI;EACX,OAAOA,GAAG;AACd;AAEA,SAASiB,eAAeA,CACpBC,OAAe,EACfC,IAAY,EACZpB,UAAe,EACT;EACN,OAAO,EAAE,GAAG,IAAI,GACZmB,OAAO,GAAG,IAAI,GACdpB,kBAAkB,CAACC,UAAU,CAAC;AACtC;AAEA,WAAaqB,OAAO,0BAAAC,MAAA;EAKhB;;EAEA,SAAAD,QACID,IAAgB,EAChBD,OAAe,EACfnB,UAA6B,GAAG,CAAC,CAAC,EACpC;IAAA,IAAAuB,KAAA;IACE,IAAMC,GAAG,GAAGN,eAAe,CAACC,OAAO,EAAEC,IAAI,EAAEpB,UAAU,CAAC;IACtDuB,KAAA,GAAAD,MAAA,CAAAG,IAAA,OAAMD,GAAG,CAAC;IACVD,KAAA,CAAKH,IAAI,GAAGA,IAAI;IAChBG,KAAA,CAAKJ,OAAO,GAAGK,GAAG;IAClBD,KAAA,CAAKG,GAAG,GAAGC,WAAW,CAACP,IAAI,CAAC;IAC5BG,KAAA,CAAKvB,UAAU,GAAGA,UAAU;IAC5BuB,KAAA,CAAKK,IAAI,GAAG,IAAI,CAAC,CAAC;IAAA,OAAAL,KAAA;EACtB;EAACM,cAAA,CAAAR,OAAA,EAAAC,MAAA;EAAA,IAAAQ,MAAA,GAAAT,OAAA,CAAAU,SAAA;EAAAD,MAAA,CAIDE,QAAQ,GAAR,SAAAA,QAAQA,CAAA,EAAW;IACf,OAAO,IAAI,CAACb,OAAO;EACvB,CAAC;EAAA,OAAAc,YAAA,CAAAZ,OAAA;IAAAa,GAAA;IAAAC,GAAA,EALD,SAAAA,CAAA,EAAmB;MACf,OAAO,WAAW,GAAG,IAAI,CAACf,IAAI,GAAG,GAAG;IACxC;EAAC;IAAAc,GAAA;IAAAC,GAAA,EAID,SAAAA,CAAA,EAAyB;MACrB,OAAO,KAAK;IAChB;EAAC;AAAA,eAAAC,gBAAA,CA5BwBC,KAAK;AA+BlC,WAAaC,WAAW,0BAAAC,UAAA;EAKpB;;EAEA,SAAAD,YACIlB,IAAgB,EAChBD,OAAe,EACfnB,UAA6B,GAAG,CAAC,CAAC,EACpC;IAAA,IAAAwC,MAAA;IACE,IAAMhB,GAAG,GAAGN,eAAe,CAACC,OAAO,EAAEC,IAAI,EAAEpB,UAAU,CAAC;IACtDwC,MAAA,GAAAD,UAAA,CAAAd,IAAA,OAAMD,GAAG,CAAC;IACVgB,MAAA,CAAKpB,IAAI,GAAGA,IAAI;IAChBoB,MAAA,CAAKrB,OAAO,GAAGK,GAAG;IAClBgB,MAAA,CAAKd,GAAG,GAAGC,WAAW,CAACP,IAAI,CAAC;IAC5BoB,MAAA,CAAKxC,UAAU,GAAGA,UAAU;IAC5BwC,MAAA,CAAKZ,IAAI,GAAG,IAAI,CAAC,CAAC;IAAA,OAAAY,MAAA;EACtB;EAACX,cAAA,CAAAS,WAAA,EAAAC,UAAA;EAAA,IAAAE,OAAA,GAAAH,WAAA,CAAAP,SAAA;EAAAU,OAAA,CAIDT,QAAQ,GAAR,SAAAA,QAAQA,CAAA,EAAW;IACf,OAAO,IAAI,CAACb,OAAO;EACvB,CAAC;EAAA,OAAAc,YAAA,CAAAK,WAAA;IAAAJ,GAAA;IAAAC,GAAA,EALD,SAAAA,CAAA,EAAmB;MACf,OAAO,eAAe,GAAG,IAAI,CAACf,IAAI,GAAG,GAAG;IAC5C;EAAC;IAAAc,GAAA;IAAAC,GAAA,EAID,SAAAA,CAAA,EAAyB;MACrB,OAAO,IAAI;IACf;EAAC;AAAA,eAAAC,gBAAA,CA5B4BM,SAAS;AAgC1C,OAAO,SAASf,WAAWA,CAACP,IAAgB,EAAE;EAC1C,OAAO,+CAA+C,GAAGA,IAAI;AACjE;AAEA,OAAO,SAASuB,YAAYA,CAACvB,IAAgB,EAAE;EAC3C,OAAO,yCAAyC,GAAGO,WAAW,CAACP,IAAI,CAAC,GAAG,KAAK;AAChF;AAEA,OAAO,SAASwB,UAAUA,CACtBxB,IAAgB,EAChBpB,UAA8B,EACvB;EACP,OAAO,IAAIqB,OAAO,CACdD,IAAI,EACJtB,YAAY,CAAC+C,kBAAkB,CAACzB,IAAI,CAAC,GAAGuB,YAAY,CAACvB,IAAI,CAAC,EAC1DpB,UACJ,CAAC;AACL;AAEA,OAAO,SAAS8C,cAAcA,CAC1B1B,IAAgB,EAChBpB,UAA8B,EACnB;EACX,OAAO,IAAIsC,WAAW,CAClBlB,IAAI,EACJtB,YAAY,CAAC+C,kBAAkB,CAACzB,IAAI,CAAC,GAAGuB,YAAY,CAACvB,IAAI,CAAC,EAC1DpB,UACJ,CAAC;AACL;;AAGA;AACA;AACA;AACA;AACA,OAAO,SAAS+C,wBAAwBA,CACpCtC,GAA0C,EACI;EAC9C,IACIA,GAAG,IACHA,GAAG,CAACuC,MAAM,KAAK,GAAG,EACpB;IACE,OAAOvC,GAAG;EACd,CAAC,MAAM;IACH,OAAO,KAAK;EAChB;AACJ;AAGA,IAAMwC,mCAA6D,GAAG;EAClE,GAAG,EAAE,yBAAyB;EAC9B,GAAG,EAAE,yBAAyB;EAC9B,GAAG,EAAE;AACT,CAAC;AAED,OAAO,SAASC,4BAA4BA,CAACzC,GAA6B,EAAW;EACjF,OAAOmC,UAAU,CAAC,OAAO,EAAE;IACvBO,IAAI,EAAEF,mCAAmC,CAACxC,GAAG,CAACuC,MAAM,CAAC;IACrDI,QAAQ,EAAE3C,GAAG,CAAC4C,UAAU;IACxBC,UAAU,EAAE7C;EAChB,CAAC,CAAC;AACN","ignoreList":[]}